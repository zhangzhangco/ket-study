<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KET词汇学习系统 - 功能测试</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .flip-card {
            perspective: 1000px;
            width: 100%;
            height: 320px;
        }
        
        .flip-card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }
        
        .flip-card.flipped .flip-card-inner {
            transform: rotateY(180deg);
        }
        
        .flip-card-front, .flip-card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .flip-card-back {
            transform: rotateY(180deg);
        }
        
        .progress-ring {
            transform: rotate(-90deg);
        }
        
        .progress-ring-circle {
            transition: stroke-dashoffset 0.35s;
            stroke-dasharray: 339.292;
            stroke-dashoffset: 339.292;
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .slide-up {
            animation: slideUp 0.4s ease-out;
        }
        
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: transform 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }

        .category-card {
            transition: all 0.3s ease;
        }
        
        .category-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .pulse-animation {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="app" class="min-h-screen">
        <!-- 应用内容将在这里渲染 -->
    </div>

    <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.js"></script>
    <script>
        const { createApp, ref, computed, onMounted, watch } = Vue;
        
        // 应用状态管理
        const useVocabularyStore = () => {
            const vocabulary = ref([]);
            const categories = ref({});
            const progress = ref({});
            const currentCategory = ref('all');
            const currentWordIndex = ref(0);
            const studyMode = ref('flashcard'); // flashcard, quiz, review
            const isFlipped = ref(false);
            const showStats = ref(false);
            const showTestPanel = ref(true);

            // 艾宾浩斯复习间隔（单位：小时）
            // 20分钟, 1小时, 8小时, 1天, 3天, 7天
            const EBBINGHAUS_SCHEDULE = [1/3, 1, 8, 24, 72, 168];
            
            // 从localStorage加载进度
            const loadProgress = () => {
                try {
                    const saved = localStorage.getItem('vocabularyProgress');
                    if (saved) {
                        progress.value = JSON.parse(saved);
                    }
                } catch (error) {
                    console.error('加载进度失败:', error);
                }
            };
            
            // 保存进度到localStorage
            const saveProgress = () => {
                try {
                    localStorage.setItem('vocabularyProgress', JSON.stringify(progress.value));
                } catch (error) {
                    console.error('保存进度失败:', error);
                }
            };
            
            // 初始化进度
            const initializeProgress = (wordId) => {
                if (!progress.value[wordId]) {
                    progress.value[wordId] = {
                        wordId,
                        level: 'new',
                        correctCount: 0,
                        incorrectCount: 0,
                        lastReviewed: null,
                        nextReview: null,
                        reviewInterval: EBBINGHAUS_SCHEDULE[0],
                        reviewStep: 0,
                        accuracy: 0
                    };
                }
            };
            
            // 更新学习进度
            const updateProgress = (wordId, isCorrect) => {
                try {
                    const wordProgress = progress.value[wordId];
                    if (!wordProgress) return;
                    
                    const now = new Date();
                    
                    // 更新统计
                    if (isCorrect) {
                        wordProgress.correctCount++;
                    } else {
                        wordProgress.incorrectCount++;
                    }
                    
                    // 计算准确率
                    const total = wordProgress.correctCount + wordProgress.incorrectCount;
                    wordProgress.accuracy = total > 0 ? wordProgress.correctCount / total : 0;
                    
                    // 更新时间
                    wordProgress.lastReviewed = now.toISOString();
                    
                    // 更新掌握程度
                    updateMasteryLevel(wordProgress, isCorrect);
                    
                    // 基于艾宾浩斯间隔更新复习进度
                    if (typeof wordProgress.reviewStep !== 'number') {
                        wordProgress.reviewStep = 0;
                    }
                    if (isCorrect) {
                        wordProgress.reviewStep = Math.min(wordProgress.reviewStep + 1, EBBINGHAUS_SCHEDULE.length - 1);
                    } else {
                        wordProgress.reviewStep = Math.max(wordProgress.reviewStep - 1, 0);
                    }
                    wordProgress.reviewInterval = EBBINGHAUS_SCHEDULE[wordProgress.reviewStep];
                    
                    // 计算下次复习时间
                    wordProgress.nextReview = calculateNextReview(wordProgress).toISOString();
                    
                    saveProgress();
                    
                    // 显示反馈
                    showFeedback(isCorrect ? '回答正确！' : '继续加油！', isCorrect);
                    
                } catch (error) {
                    console.error('更新进度失败:', error);
                }
            };
            
            // 更新掌握程度
            const updateMasteryLevel = (wordProgress, isCorrect) => {
                const consecutiveCorrect = wordProgress.correctCount;
                const consecutiveIncorrect = wordProgress.incorrectCount;
                
                if (isCorrect) {
                    if (consecutiveCorrect >= 3 && wordProgress.level === 'new') {
                        wordProgress.level = 'learning';
                        wordProgress.reviewInterval = 1;
                    } else if (consecutiveCorrect >= 5 && wordProgress.level === 'learning') {
                        wordProgress.level = 'familiar';
                        wordProgress.reviewInterval = 24;
                    } else if (consecutiveCorrect >= 8 && wordProgress.level === 'familiar') {
                        wordProgress.level = 'mastered';
                        wordProgress.reviewInterval = 72;
                    }
                } else {
                    if (consecutiveIncorrect >= 2 && wordProgress.level === 'mastered') {
                        wordProgress.level = 'familiar';
                        wordProgress.reviewInterval = 24;
                    } else if (consecutiveIncorrect >= 3 && wordProgress.level === 'familiar') {
                        wordProgress.level = 'learning';
                        wordProgress.reviewInterval = 1;
                    } else if (consecutiveIncorrect >= 4 && wordProgress.level === 'learning') {
                        wordProgress.level = 'new';
                        wordProgress.reviewInterval = 1;
                    }
                }
            };
            
            // 计算下次复习时间
            const calculateNextReview = (wordProgress) => {
                const now = new Date();
                const nextReview = new Date(now.getTime() + wordProgress.reviewInterval * 60 * 60 * 1000);
                return nextReview;
            };
            
            // 显示反馈
            const showFeedback = (message, isSuccess) => {
                const feedback = document.createElement('div');
                feedback.className = `fixed top-4 right-4 px-6 py-3 rounded-lg text-white font-medium z-50 ${
                    isSuccess ? 'bg-green-500' : 'bg-red-500'
                }`;
                feedback.textContent = message;
                document.body.appendChild(feedback);
                
                setTimeout(() => {
                    feedback.remove();
                }, 2000);
            };
            
            // 获取当前分类的词汇
            const currentWords = computed(() => {
                if (currentCategory.value === 'all') {
                    return vocabulary.value;
                }
                return categories.value[currentCategory.value] || [];
            });
            
            // 获取当前单词
            const currentWord = computed(() => {
                if (currentWords.value.length === 0) return null;
                // 防止索引越界导致 undefined 而不显示
                const idx = Math.min(currentWordIndex.value, Math.max(currentWords.value.length - 1, 0));
                return currentWords.value[idx];
            });

            // 当分类变化时，重置索引与翻面状态
            watch(currentCategory, () => {
                currentWordIndex.value = 0;
                isFlipped.value = false;
            });

            // 当当前词列表变化时，若索引越界则回到0
            watch(currentWords, (newWords) => {
                if (!newWords) return;
                if (currentWordIndex.value >= newWords.length) {
                    currentWordIndex.value = 0;
                }
            });
            
            // 获取学习统计
            const statistics = computed(() => {
                const stats = {
                    total: vocabulary.value.length,
                    new: 0,
                    learning: 0,
                    familiar: 0,
                    mastered: 0,
                    accuracy: 0,
                    todayStudied: 0,
                    reviewCount: 0
                };
                
                Object.values(progress.value).forEach(p => {
                    if (p && p.level && Object.prototype.hasOwnProperty.call(stats, p.level)) {
                        stats[p.level]++;
                    }
                    
                    // 计算今日学习（仅统计有过尝试的词）
                    const attempts = (p?.correctCount || 0) + (p?.incorrectCount || 0);
                    if (attempts > 0 && p?.lastReviewed) {
                        const lastReview = new Date(p.lastReviewed);
                        const today = new Date();
                        if (!isNaN(lastReview.getTime()) && lastReview.toDateString() === today.toDateString()) {
                            stats.todayStudied++;
                        }
                    }
                    
                    // 计算需要复习（仅当 nextReview 存在且有效）
                    if (p?.nextReview) {
                        const nextReview = new Date(p.nextReview);
                        if (!isNaN(nextReview.getTime()) && nextReview <= new Date()) {
                            stats.reviewCount++;
                        }
                    }
                });
                
                const totalAttempts = Object.values(progress.value).reduce((sum, p) => 
                    sum + p.correctCount + p.incorrectCount, 0);
                const totalCorrect = Object.values(progress.value).reduce((sum, p) => 
                    sum + p.correctCount, 0);
                
                stats.accuracy = totalAttempts > 0 ? totalCorrect / totalAttempts : 0;
                
                return stats;
            });
            
            // 检查是否需要复习
            const needsReview = (wordProgress) => {
                if (!wordProgress || !wordProgress.nextReview) return false;
                const nextReviewDate = new Date(wordProgress.nextReview);
                if (isNaN(nextReviewDate.getTime())) return false;
                return nextReviewDate <= new Date();
            };

            // 获取需要复习的单词
            const wordsForReview = computed(() => {
                const now = new Date();
                return vocabulary.value
                    .filter(word => {
                        const wordProgress = progress.value[word.id];
                        return needsReview(wordProgress);
                    })
                    .sort((a, b) => {
                        const pa = progress.value[a.id];
                        const pb = progress.value[b.id];
                        const overdueA = now - new Date(pa.nextReview);
                        const overdueB = now - new Date(pb.nextReview);
                        // 逾期越久，排位越靠前
                        return overdueB - overdueA;
                    });
            });
            
            // 下一个单词 - 使用动画锁定机制
            const nextWord = () => {
                if (currentWords.value.length === 0) return;
                if (currentWordIndex.value < currentWords.value.length - 1) {
                    currentWordIndex.value++;
                } else {
                    currentWordIndex.value = 0;
                }
                isFlipped.value = false;
            };
            
            // 上一个单词 - 使用动画锁定机制
            const prevWord = () => {
                if (currentWords.value.length === 0) return;
                if (currentWordIndex.value > 0) {
                    currentWordIndex.value--;
                } else {
                    currentWordIndex.value = currentWords.value.length - 1;
                }
                isFlipped.value = false;
            };
            
            // 随机单词 - 使用动画锁定机制
            const randomWord = () => {
                if (currentWords.value.length === 0) return;
                currentWordIndex.value = Math.floor(Math.random() * currentWords.value.length);
                isFlipped.value = false;
            };
            
            // 重置进度
            const resetProgress = () => {
                if (confirm('确定要重置所有学习进度吗？此操作不可撤销。')) {
                    progress.value = {};
                    // 重置后立即为所有单词重新初始化默认进度
                    (vocabulary.value || []).forEach(word => initializeProgress(word.id));
                    saveProgress();
                    showFeedback('进度已重置', true);
                }
            };
            
            // 导出进度
            const exportProgress = () => {
                const data = {
                    progress: progress.value,
                    statistics: statistics.value,
                    exportDate: new Date().toISOString()
                };
                
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `ket-progress-${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);
                
                showFeedback('进度已导出', true);
            };
            
            // 导入进度
            const importProgress = () => {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json';
                input.onchange = (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            try {
                                const data = JSON.parse(e.target.result);
                                if (data.progress) {
                                    progress.value = data.progress;
                                    saveProgress();
                                    showFeedback('进度已导入', true);
                                }
                            } catch (error) {
                                showFeedback('导入失败：文件格式错误', false);
                            }
                        };
                        reader.readAsText(file);
                    }
                };
                input.click();
            };
            
            return {
                vocabulary,
                categories,
                progress,
                currentCategory,
                currentWordIndex,
                studyMode,
                isFlipped,
                showStats,
                showTestPanel,
                currentWords,
                currentWord,
                statistics,
                wordsForReview,
                loadProgress,
                initializeProgress,
                updateProgress,
                nextWord,
                prevWord,
                randomWord,
                resetProgress,
                exportProgress,
                importProgress
            };
        };
        
        // Vue应用
        createApp({
            setup() {
                const store = useVocabularyStore();
                const loading = ref(true);
                const error = ref(null);
                
                // 语音合成
                const speakWord = (text) => {
                    if ('speechSynthesis' in window) {
                        // 停止当前播放
                        speechSynthesis.cancel();
                        
                        const utterance = new SpeechSynthesisUtterance(text);
                        utterance.lang = 'en-US';
                        utterance.rate = 0.8;
                        utterance.pitch = 1;
                        utterance.volume = 1;
                        
                        speechSynthesis.speak(utterance);
                    } else {
                        showFeedback('浏览器不支持语音功能', false);
                    }
                };
                
                // 翻转卡片
                const flipCard = () => {
                    store.isFlipped.value = !store.isFlipped.value;
                };
                
                // 增加缓冲区和切换锁定
                const displayWord = ref(null);
                const isSwitching = ref(false);
                
                
                // 监听当前单词变化，但仅在非切换状态时更新缓冲区
                watch(() => store.currentWord.value, (newWord) => {
                    if (!isSwitching.value && newWord) {
                        displayWord.value = { ...newWord };
                    }
                });
                
                // 翻转卡片时候也确保内容正确
                watch(() => store.isFlipped.value, (isFlipped) => {
                    if (!isFlipped && !isSwitching.value && store.currentWord.value) {
                        displayWord.value = { ...store.currentWord.value };
                    }
                });
                
                // 处理答题，使用动画锁定
                const handleAnswer = (isCorrect) => {
                    if (store.currentWord.value && !isSwitching.value) {
                        // 先更新学习进度
                        store.updateProgress(store.currentWord.value.id, isCorrect);
                        
                        // 锁定状态，阻止重复点击
                        isSwitching.value = true;
                        
                        // 先翻转到正面（蓝色）
                        store.isFlipped.value = false;
                        
                        // 等待翻转动画完成后才切换单词
                        setTimeout(() => {
                            // 切换到下一个单词
                            store.nextWord();
                            
                            // 等后台数据切换完成后再更新展示内容
                            displayWord.value = store.currentWord.value ? { ...store.currentWord.value } : null;
                            
                            // 解锁，允许再次操作
                            isSwitching.value = false;
                        }, 600); // 稍微超过CSS动画时间以确保动画完成
                    }
                };
                
                // 标记为已掌握，使用相同的动画控制机制
                const markAsMastered = () => {
                    if (store.currentWord.value && !isSwitching.value) {
                        const wordProgress = store.progress.value[store.currentWord.value.id];
                        if (wordProgress) {
                            wordProgress.correctCount = 8;
                            wordProgress.level = 'familiar';
                            store.updateProgress(store.currentWord.value.id, true);
                        }
                        
                        // 锁定切换
                        isSwitching.value = true;
                        
                        // 先翻转到正面
                        store.isFlipped.value = false;
                        
                        // 等动画完成后切换单词
                        setTimeout(() => {
                            store.nextWord();
                            displayWord.value = store.currentWord.value ? { ...store.currentWord.value } : null;
                            isSwitching.value = false;
                        }, 600);
                    }
                };
                
                // 导航按钮包装函数 - 处理动画同步
                const handleNextWord = () => {
                    if (isSwitching.value) return;
                    
                    if (store.isFlipped.value) {
                        // 如果在背面，先翻到正面再切换
                        isSwitching.value = true;
                        store.isFlipped.value = false;
                        setTimeout(() => {
                            store.nextWord();
                            displayWord.value = store.currentWord.value ? { ...store.currentWord.value } : null;
                            isSwitching.value = false;
                        }, 600);
                    } else {
                        // 如果在正面，直接切换
                        store.nextWord();
                        displayWord.value = store.currentWord.value ? { ...store.currentWord.value } : null;
                    }
                };
                
                const handlePrevWord = () => {
                    if (isSwitching.value) return;
                    
                    if (store.isFlipped.value) {
                        isSwitching.value = true;
                        store.isFlipped.value = false;
                        setTimeout(() => {
                            store.prevWord();
                            displayWord.value = store.currentWord.value ? { ...store.currentWord.value } : null;
                            isSwitching.value = false;
                        }, 600);
                    } else {
                        store.prevWord();
                        displayWord.value = store.currentWord.value ? { ...store.currentWord.value } : null;
                    }
                };
                
                const handleRandomWord = () => {
                    if (isSwitching.value) return;
                    
                    if (store.isFlipped.value) {
                        isSwitching.value = true;
                        store.isFlipped.value = false;
                        setTimeout(() => {
                            store.randomWord();
                            displayWord.value = store.currentWord.value ? { ...store.currentWord.value } : null;
                            isSwitching.value = false;
                        }, 600);
                    } else {
                        store.randomWord();
                        displayWord.value = store.currentWord.value ? { ...store.currentWord.value } : null;
                    }
                };
                
                // 显示反馈
                const showFeedback = (message, isSuccess) => {
                    const feedback = document.createElement('div');
                    feedback.className = `fixed top-4 right-4 px-6 py-3 rounded-lg text-white font-medium z-50 ${
                        isSuccess ? 'bg-green-500' : 'bg-red-500'
                    }`;
                    feedback.textContent = message;
                    document.body.appendChild(feedback);
                    
                    setTimeout(() => {
                        feedback.remove();
                    }, 2000);
                };
                
                // 初始化数据
                onMounted(async () => {
                    try {
                        console.log('开始加载词汇数据...');
                        
                        // 加载词汇数据
                        const [vocabResponse, categoriesResponse] = await Promise.all([
                            fetch('/data/vocabulary.json'),
                            fetch('/data/categories.json')
                        ]);
                        
                        if (!vocabResponse.ok || !categoriesResponse.ok) {
                            throw new Error('数据加载失败');
                        }
                        
                        store.vocabulary.value = await vocabResponse.json();
                        store.categories.value = await categoriesResponse.json();
                        
                        console.log(`加载了 ${store.vocabulary.value.length} 个词汇`);
                        console.log(`加载了 ${Object.keys(store.categories.value).length} 个分类`);
                        
                        // 初始化进度
                        store.vocabulary.value.forEach(word => {
                            store.initializeProgress(word.id);
                        });
                        
                        // 加载保存的进度
                        store.loadProgress();
                        
                        loading.value = false;
                        
                        // 初始化缓冲区
                        if (store.currentWord.value) {
                            displayWord.value = { ...store.currentWord.value };
                        }
                        
                        console.log('应用初始化完成');
                        
                    } catch (err) {
                        console.error('初始化失败:', err);
                        error.value = '数据加载失败，请检查服务器连接';
                        loading.value = false;
                    }
                });
                
                return {
                    ...store,
                    loading,
                    error,
                    speakWord,
                    flipCard,
                    handleAnswer,
                    markAsMastered,
                    displayWord,
                    isSwitching,
                    handleNextWord,
                    handlePrevWord,
                    handleRandomWord
                };
            },
            template: `
                <div class="container mx-auto px-4 py-8 max-w-7xl">
                    <!-- 加载状态 -->
                    <div v-if="loading" class="text-center py-12">
                        <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"></div>
                        <p class="mt-4 text-gray-600">正在加载词汇数据...</p>
                    </div>
                    
                    <!-- 错误状态 -->
                    <div v-if="error" class="text-center py-12">
                        <i class="fas fa-exclamation-triangle text-6xl text-red-500 mb-4"></i>
                        <p class="text-xl text-red-600 mb-4">{{ error }}</p>
                        <button @click="location.reload()" class="px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
                            重新加载
                        </button>
                    </div>
                    
                    <!-- 主要内容 -->
                    <div v-if="!loading && !error">
                        <!-- 头部 -->
                        <header class="text-center mb-8">
                            <h1 class="text-4xl font-bold text-gray-800 mb-2">KET词汇学习系统</h1>
                            <p class="text-gray-600">基于艾宾浩斯记忆曲线的智能学习系统</p>
                        </header>
                        
                        <!-- 统计卡片 -->
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                            <div class="stat-card text-white p-6 rounded-xl shadow-lg">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm opacity-90 mb-1">总词汇量</p>
                                        <p class="text-3xl font-bold">{{ statistics.total }}</p>
                                    </div>
                                    <i class="fas fa-book text-3xl opacity-80"></i>
                                </div>
                            </div>
                            
                            <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm text-gray-600 mb-1">掌握程度</p>
                                        <p class="text-3xl font-bold text-green-600">{{ Math.round(statistics.accuracy * 100) }}%</p>
                                    </div>
                                    <i class="fas fa-chart-line text-3xl text-green-500"></i>
                                </div>
                            </div>
                            
                            <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm text-gray-600 mb-1">今日学习</p>
                                        <p class="text-3xl font-bold text-orange-600">{{ statistics.todayStudied }}</p>
                                    </div>
                                    <i class="fas fa-calendar-day text-3xl text-orange-500"></i>
                                </div>
                            </div>
                            
                            <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm text-gray-600 mb-1">待复习</p>
                                        <p class="text-3xl font-bold text-red-600">{{ statistics.reviewCount }}</p>
                                    </div>
                                    <i class="fas fa-clock text-3xl text-red-500"></i>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 控制面板 -->
                        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
                            <div class="flex flex-wrap gap-4 items-center justify-between">
                                <div class="flex flex-wrap gap-4">
                                    <select v-model="currentCategory" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                        <option value="all">全部词汇 ({{ vocabulary.length }})</option>
                                        <option v-for="(words, category) in categories" :key="category" :value="category">
                                            {{ category }} ({{ words.length }})
                                        </option>
                                    </select>
                                    
                                    <div class="flex gap-2">
                                        <button @click="studyMode = 'flashcard'" 
                                                :class="['px-4 py-2 rounded-lg transition-colors', studyMode === 'flashcard' ? 'bg-blue-500 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300']">
                                            <i class="fas fa-clone mr-2"></i>抽认卡
                                        </button>
                                        <button @click="studyMode = 'review'" 
                                                :class="['px-4 py-2 rounded-lg transition-colors', studyMode === 'review' ? 'bg-blue-500 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300']">
                                            <i class="fas fa-redo mr-2"></i>复习模式
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="flex gap-2">
                                    <button @click="showStats = !showStats" class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors">
                                        <i class="fas fa-chart-bar mr-2"></i>统计
                                    </button>
                                    <button @click="showTestPanel = !showTestPanel" class="px-4 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition-colors">
                                        <i class="fas fa-cog mr-2"></i>测试
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 测试面板 -->
                        <div v-if="showTestPanel" class="bg-yellow-50 border border-yellow-200 rounded-xl p-6 mb-8">
                            <h3 class="text-lg font-semibold text-yellow-800 mb-4">
                                <i class="fas fa-tools mr-2"></i>功能测试面板
                            </h3>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <button @click="exportProgress" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors">
                                    <i class="fas fa-download mr-2"></i>导出进度
                                </button>
                                <button @click="importProgress" class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors">
                                    <i class="fas fa-upload mr-2"></i>导入进度
                                </button>
                                <button @click="resetProgress" class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors">
                                    <i class="fas fa-trash mr-2"></i>重置进度
                                </button>
                            </div>
                            <div class="mt-4 text-sm text-yellow-700">
                                <p><strong>提示：</strong>您可以使用这些按钮来测试数据导入导出功能。</p>
                            </div>
                        </div>
                        
                        <!-- 统计面板 -->
                        <div v-if="showStats" class="bg-white rounded-xl shadow-lg p-6 mb-8 fade-in">
                            <h3 class="text-xl font-semibold mb-6">详细统计</h3>
                            <div class="grid grid-cols-1 md:grid-cols-5 gap-6 mb-6">
                                <div class="text-center p-4 bg-gray-50 rounded-lg">
                                    <div class="text-2xl font-bold text-gray-600 mb-1">{{ statistics.new }}</div>
                                    <div class="text-sm text-gray-500">新词</div>
                                </div>
                                <div class="text-center p-4 bg-yellow-50 rounded-lg">
                                    <div class="text-2xl font-bold text-yellow-600 mb-1">{{ statistics.learning }}</div>
                                    <div class="text-sm text-yellow-600">学习中</div>
                                </div>
                                <div class="text-center p-4 bg-orange-50 rounded-lg">
                                    <div class="text-2xl font-bold text-orange-600 mb-1">{{ statistics.familiar }}</div>
                                    <div class="text-sm text-orange-600">熟悉</div>
                                </div>
                                <div class="text-center p-4 bg-green-50 rounded-lg">
                                    <div class="text-2xl font-bold text-green-600 mb-1">{{ statistics.mastered }}</div>
                                    <div class="text-sm text-green-600">已掌握</div>
                                </div>
                                <div class="text-center p-4 bg-blue-50 rounded-lg">
                                    <div class="text-2xl font-bold text-blue-600 mb-1">{{ wordsForReview.length }}</div>
                                    <div class="text-sm text-blue-600">需复习</div>
                                </div>
                            </div>
                            
                            <!-- 进度条 -->
                            <div class="mb-6">
                                <div class="flex justify-between text-sm text-gray-600 mb-2">
                                    <span>总体掌握进度</span>
                                    <span>{{ Math.round(((statistics.mastered + statistics.familiar * 0.5 + statistics.learning * 0.2) / statistics.total) * 100) }}%</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-3">
                                    <div class="bg-gradient-to-r from-blue-500 to-green-500 h-3 rounded-full transition-all duration-300" 
                                         :style="{'width': ((statistics.mastered + statistics.familiar * 0.5 + statistics.learning * 0.2) / statistics.total) * 100 + '%'}"></div>
                                </div>
                            </div>
                            
                            <!-- 复习提醒 -->
                            <div v-if="statistics.reviewCount > 0" class="bg-red-50 border border-red-200 rounded-lg p-4">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h4 class="font-semibold text-red-800 mb-1">复习提醒</h4>
                                        <p class="text-sm text-red-600">您有 {{ statistics.reviewCount }} 个单词需要复习</p>
                                    </div>
                                    <button @click="studyMode = 'review'; showStats = false" 
                                            class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors">
                                        开始复习
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 抽认卡区域 -->
                        <div v-if="currentWord && studyMode === 'flashcard'" class="max-w-2xl mx-auto">
                            <div class="flip-card" :class="{ flipped: isFlipped }" @click="flipCard">
                                <div class="flip-card-inner">
                                    <!-- 正面 -->
                                    <div class="flip-card-front bg-gradient-to-br from-blue-500 to-purple-600 text-white flex flex-col justify-center items-center p-8">
                                        <div class="text-center">
                                            <h2 class="text-4xl font-bold mb-4">{{ displayWord ? displayWord.english : currentWord.english }}</h2>
                                            <p class="text-xl mb-6 opacity-90">{{ displayWord ? displayWord.ipa : currentWord.ipa }}</p>
                                            <button @click.stop="speakWord(displayWord ? displayWord.english : currentWord.english)" 
                                                    class="bg-white bg-opacity-20 hover:bg-opacity-30 px-6 py-3 rounded-lg transition-all">
                                                <i class="fas fa-volume-up mr-2"></i>发音
                                            </button>
                                        </div>
                                        <div class="absolute bottom-4 left-4 text-sm opacity-75">
                                            <i class="fas fa-tag mr-1"></i>{{ displayWord ? displayWord.category : currentWord.category }}
                                        </div>
                                        <div class="absolute bottom-4 right-4 text-sm opacity-75">
                                            {{ currentWordIndex + 1 }} / {{ currentWords.length }}
                                        </div>
                                    </div>
                                    
                                    <!-- 背面 -->
                                    <div class="flip-card-back bg-gradient-to-br from-green-500 to-teal-600 text-white flex flex-col justify-center items-center p-8">
                                        <div class="text-center">
                                            <h2 class="text-3xl font-bold mb-4">{{ displayWord ? displayWord.chinese : currentWord.chinese }}</h2>
                                            <p class="text-xl mb-2">{{ displayWord ? displayWord.english : currentWord.english }}</p>
                                            <p class="text-lg mb-6 opacity-90">{{ displayWord ? displayWord.ipa : currentWord.ipa }}</p>
                                            <div class="text-sm opacity-75">
                                                <span class="inline-block px-3 py-1 bg-white bg-opacity-20 rounded-full">
                                                    {{ getLevelText(progress[displayWord ? displayWord.id : currentWord.id]?.level || 'new') }}
                                                </span>
                                            </div>
                                        </div>
                                        <div class="absolute bottom-4 left-4 text-sm opacity-75">
                                            <i class="fas fa-tag mr-1"></i>{{ displayWord ? displayWord.category : currentWord.category }}
                                        </div>
                                        <div class="absolute bottom-4 right-4 text-sm opacity-75">
                                            {{ currentWordIndex + 1 }} / {{ currentWords.length }}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 控制按钮 -->
                            <div class="mt-6 flex justify-center gap-4">
                                <button @click="handlePrevWord" :disabled="isSwitching" class="px-6 py-3 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors" :class="{ 'opacity-50 cursor-not-allowed': isSwitching }">
                                    <i class="fas fa-chevron-left mr-2"></i>上一个
                                </button>
                                <button @click="handleRandomWord" :disabled="isSwitching" class="px-6 py-3 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition-colors" :class="{ 'opacity-50 cursor-not-allowed': isSwitching }">
                                    <i class="fas fa-random mr-2"></i>随机
                                </button>
                                <button @click="handleNextWord" :disabled="isSwitching" class="px-6 py-3 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors" :class="{ 'opacity-50 cursor-not-allowed': isSwitching }">
                                    下一个<i class="fas fa-chevron-right ml-2"></i>
                                </button>
                            </div>
                            
                            <!-- 学习按钮 -->
                            <div v-if="isFlipped" class="mt-6 flex justify-center gap-4 slide-up">
                                <button @click="handleAnswer(false)" :disabled="isSwitching" class="px-8 py-3 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors" :class="{ 'opacity-50 cursor-not-allowed': isSwitching }">
                                    <i class="fas fa-times mr-2"></i>不认识
                                </button>
                                <button @click="markAsMastered" :disabled="isSwitching" class="px-8 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors" :class="{ 'opacity-50 cursor-not-allowed': isSwitching }">
                                    <i class="fas fa-check mr-2"></i>已掌握
                                </button>
                                <button @click="handleAnswer(true)" :disabled="isSwitching" class="px-8 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors" :class="{ 'opacity-50 cursor-not-allowed': isSwitching }">
                                    <i class="fas fa-lightbulb mr-2"></i>认识
                                </button>
                            </div>
                        </div>
                        
                        <!-- 复习模式 -->
                        <div v-if="studyMode === 'review'" class="max-w-6xl mx-auto">
                            <div class="bg-white rounded-xl shadow-lg p-6">
                                <h3 class="text-xl font-semibold mb-6">
                                    <i class="fas fa-redo mr-2"></i>复习词汇
                                    <span v-if="wordsForReview.length > 0" class="text-sm text-red-500 ml-2">
                                        ({{ wordsForReview.length }} 个需要复习)
                                    </span>
                                </h3>
                                
                                <div v-if="wordsForReview.length === 0" class="text-center py-12">
                                    <i class="fas fa-check-circle text-6xl text-green-500 mb-4"></i>
                                    <p class="text-xl text-gray-600 mb-2">太棒了！</p>
                                    <p class="text-gray-500">暂无需要复习的词汇</p>
                                </div>
                                
                                <div v-else>
                                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
                                        <div v-for="word in wordsForReview.slice(0, 12)" :key="word.id"
                                             class="p-4 border rounded-lg hover:bg-gray-100 cursor-pointer flex justify-between items-center"
                                             @click="currentCategory = 'all'; currentWordIndex = vocabulary.findIndex(w => w.id === word.id); studyMode = 'flashcard'">
                                            <span>{{ word.english }}</span>
                                            <span class="text-sm text-gray-500">{{ word.category }}</span>
                                        </div>
                                    </div>
                                    
                                    <div v-if="wordsForReview.length > 12" class="text-center mt-6 text-gray-500">
                                        还有 {{ wordsForReview.length - 12 }} 个词汇需要复习
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 空状态 -->
                        <div v-if="!currentWord && currentWords.length === 0" class="text-center py-12">
                            <i class="fas fa-search text-6xl text-gray-300 mb-4"></i>
                            <p class="text-xl text-gray-500">该分类暂无词汇</p>
                        </div>
                    </div>
                </div>
            `,
            methods: {
                getLevelText(level) {
                    const levels = {
                        new: '新词',
                        learning: '学习中',
                        familiar: '熟悉',
                        mastered: '已掌握'
                    };
                    return levels[level] || '新词';
                },
                getLevelClass(level) {
                    const classes = {
                        new: 'bg-gray-100 text-gray-600',
                        learning: 'bg-yellow-100 text-yellow-600',
                        familiar: 'bg-orange-100 text-orange-600',
                        mastered: 'bg-green-100 text-green-600'
                    };
                    return classes[level] || 'bg-gray-100 text-gray-600';
                }
            }
        }).mount('#app');
    </script>
</body>
</html>